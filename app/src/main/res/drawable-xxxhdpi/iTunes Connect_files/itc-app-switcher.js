angular.module('itc-app-switcher', []);angular.module("itc-app-switcher").service("popoverMixinService",["$window","$document",function(e,n){return{mixin:function(n,t){var o,r,l,i;r=$(t).find(".app-popover");n.showContent=n.showContent||false;n.toggle=function(){return n.showContent=!n.showContent};n.close=function(){if(n.$$phase!=null){return n.showContent=false}else{return n.$apply(function(){return n.showContent=false})}};n.$watch("showContent",function(e){if(e){return _.defer(function(){$(".popover-wrap").bind("click.killpopover",function(e){return e.stopPropagation()});return $("body").bind("click.killpopover",function(e){return n.close()})})}else{$("body").unbind("click.killpopover");return $(".popover-wrap").unbind("click.killpopover")}});n.showPopover=false;n.$watch("showContent",function(e){var t;if(e){r.find(".popover-wrap:first").show();_.defer(function(){return o(r,n)});return n.showPopover=e}else{t=r.find(".popover-wrap");r.find(".popover-wrap:first").css({opacity:0});return _.delay(function(){n.showUpwards=false;r.css("top","");r.find(".popover-wrap").css({top:""}).hide();n.showPopover=e;return n.$apply()},200)}});o=function(n,t){var o,r,p,s,u,f;if(n[0]==null||n[0].parentElement==null){return false}u=n[0].parentElement.clientWidth;s=n[0].parentElement.clientHeight;r=n.find(".popover-wrap")[0];o=l(n,r);angular.element(r).css("opacity",0);p=o.width;if(t.right!=null){angular.element(r).css("right",t.right)}else if(t.left!=null){angular.element(r).css("left",t.left)}else{f=(u-p)/2;if(t.float==="left"){f=10}angular.element(r).css("left",f+"px")}if(t.forceBottom!=null){angular.element(r).css("top","");t.showUpwards=false;i(r,t);return false}t.showUpwards=e.innerHeight<o.top+o.height;if(t.top!=null){angular.element(r).css("top",t.top);t.showUpwards=false}else if(t.showUpwards){angular.element(r).css("top",-1*(o.height+s)+"px")}else{angular.element(r).css("top","")}return i(r,t)};i=function(e,n){return _.defer(function(){return _.delay(function(){var t,o,r;o=$(e);t=o[0].getBoundingClientRect();if(t.left<20){r=20-t.left;o.css({left:"+="+r+"px"});o.find(".popover-tip").css({position:"absolute",left:(n.tipleft||r)+"px"})}return _.defer(function(){return o.css({opacity:"1"})})},75)})};return l=function(e,n){return n.getBoundingClientRect()}}}}]);angular.module("itc-app-switcher").directive("appSwitcher",["$location","$animate","popoverMixinService",function(e,n,t){return{link:function(e,r,i){var a,l,u,c,o,p,s,f,d,m,h,g,L,w,b,v;e.forceBottom=true;t.mixin(e,r);s=$(r);v=false;c=[];d=[];a=0;o="";p=null;e.appLimiter=15;if(angular.version.minor<=4){n.enabled(false,r)}else{n.enabled(r,false)}l=10;u=50;e.showLink=e.showListLink!=null&&e.showListLink==="true";e.$watch("appList",function(n){if(n!=null){e.can_view_apps=true;c=e.appList;d=_.clone(e.appList);e.apps=e.appList.slice(0,+(Number(e.appLimiter)-1)+1||9e9);return e.totalCount=e.appList.length}});e.checkImage=function(e){return e.imageUrl!=null};e.imageURL=function(e){if(e.assetToken!=null){return globals.imageURLGen.generateUrlForToken({token:e.assetToken,width:170,height:170}).replace(/\.jpg$/gm,".png")}else{return e.iconUrl}};e.chooseApp=function(n){e.cancelSearch();e.onAppSelect.call(null,{app:n});return e.showContent=false};e.focusSearch=function(){s.find(".searchbox").addClass("focused");return true};e.blurSearch=function(){s.find(".searchbox").removeClass("focused");return true};e.keyupSearch=function(n){clearTimeout(p);if(n.keyCode===27&&o.length>0){e.cancelSearch();return false}o=$.trim(n.currentTarget.value);if(o.length>0){s.find(".cancel").addClass("active")}else{s.find(".cancel").removeClass("active")}p=_.delay(function(){return f(o)},400);return true};e.cancelSearch=function(){if(o.length===0){return false}s.find("[name='searchinput']").val("");e.keyupSearch({currentTarget:{value:""}});return true};m=function(){d=_.clone(c);e.appsList=d.slice(0,+(Number(e.appLimiter)-1)+1||9e9);return a=e.appsList.length};f=function(n){d=_.filter(c,function(e){var t;t=e.adamId!=null?Number(e.adamId)===Number(n):e.id!=null?Number(e.id)===Number(n):false;return e.name.toLowerCase().indexOf(n.toLowerCase())!==-1||t});a=0;e.apps=d.slice(0,+(Number(e.appLimiter)-1)+1||9e9);s.find(".app_content").scrollTop(0);return e.$apply()};b=function(){var n;if(e.apps.length===d.length){return false}if(v){return false}v=true;a++;n=l*a+Number(e.appLimiter);if(n>=d.length){e.apps=d;e.$apply();return v=false}else{e.apps=d.slice(0,n);e.$apply();return v=false}};w=false;L=function(){if(w){return false}w=true;return s.find(".app_content").on("scroll",function(e){var n,t;t=e.currentTarget.getBoundingClientRect().height;n=e.currentTarget.scrollHeight-(t+e.currentTarget.scrollTop);if(n<=u){return b()}})};if(s.find(".app_content").length===1){L()}e.transcludeElementCreated=function(e){L();return true};e.$watch("showContent",function(e,n){if(e){_.defer(function(){return s.find(".app_content").scrollTop(0)});if(s.find("input").length>0){return _.delay(function(){return s.find("input").focus()},200)}}});g=function(e){return s.find(".selwrapper").css({maxWidth:e})};s.find(".imageloader").bind("load",function(){return e.setAppNameWidth.call(null,{app_name_element:s.find(".selwrapper"),resizeToAction:g})});h=null;$(window).bind("resize.appNameHeader",function(){clearTimeout(h);return h=_.delay(function(){return e.setAppNameWidth.call(null,{app_name_element:s.find(".selwrapper"),resizeToAction:g})},400)});return e.$on("$destroy",function(){return $(window).unbind("resize.appNameHeader")})},restrict:"E",templateUrl:"directives/appSwitcher.html",replace:true,scope:{baseIcon:"@",application:"=",appList:"=",noResultsLabel:"@",searchLabel:"@",typeLabel:"@",type:"=",goToList:"=",onAppSelect:"&",setAppNameWidth:"&",showListLink:"@"}}}]);angular.module("itc-app-switcher").directive("bindHtml",[function(){return{link:function(e,n,t){return e.$watch("content",function(e,t){return n.html(e)})},restrict:"A",scope:{content:"=bindHtml"}}}]);angular.module('itc-app-switcher').run(function($templateCache){$templateCache.put('directives/appSwitcher.html', '<div class="top-app-picker"><div class="selwrapper"><div ng-click="toggle()" class="selector multiple"><div ng-if="checkImage(application)" style="background-image:url(\'{{ application.imageUrl }}\');" ng-class="{\'ios7-style-icon\': application.iconType == \'iOS\', \'tvos-style-icon\': application.iconType == \'tvOS\'}" class="appicon iconsize"></div><div ng-if="!checkImage(application)" ng-class="{\'cicon-appicon-placeholder-heavy\': application.iconType !== \'tvOS\', \'tvos-noicon\': application.iconType == \'tvOS\'}" class="noicon iconsize"></div><div bind-html="application.name" class="title"></div><div class="cicon-down chooser"></div></div><div class="app-popover"><div ng-class="float" class="popover-wrap"><div ng-class="float" class="popover-tip up"></div><div class="popover-content"><div ng-if="totalCount > 10" class="search_area"><div class="searchbox"><div class="searcher cicon-search"></div><input type="text" ng-focus="focusSearch()" ng-blur="blurSearch()" ng-keyup="keyupSearch($event)" name="searchinput" ng-attr-placeholder="{{ searchLabel }}" autocomplete="off"/><div ng-click="cancelSearch()" class="cancel cicon-searchcancel"></div></div></div><div ng-init="transcludeElementCreated()" class="app_content scrolled_element"><div ng-click="goToList()" ng-show="showLink" class="basetype contain"><div style="background-image:url(\'{{ baseIcon }}\');" class="baseicon iconsize"></div><div ng-bind-template="{{ typeLabel }}" class="basetitle"></div></div><div ng-if="can_view_apps" ng-show="apps.length > 0" class="list"><div ng-repeat="app in apps" ng-click="chooseApp(app)" class="row contain"><div ng-if="checkImage(app)" style="background-image:url(\'{{ app.imageUrl }}\');" ng-class="{\'ios7-style-icon\': app.iconType == \'iOS\', \'tvos-style-icon\': app.iconType == \'tvOS\'}" class="appicon iconsize"></div><div ng-if="!checkImage(app)" ng-class="{\'cicon-appicon-placeholder-heavy\': app.iconType !== \'tvOS\', \'tvos-noicon\': app.iconType == \'tvOS\'}" class="noicon iconsize"></div><div bind-html="app.name" class="apptitle"></div></div></div><div ng-show="apps.length == 0" class="noresults"><div class="cicon-searchlg icon"></div><div ng-bind-template="{{ noResultsLabel }}" class="label"></div></div></div></div></div></div><img style="display: none;" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" imageonload="bottomPixelLoaded()" class="imageloader"/></div></div>');});